# このコードは、GridWorld（格子状の環境）における「状態価値関数 V(s)」を
# ランダムに初期化して、その値を環境の可視化機能（render_v）で表示する例です。
#
# 強化学習（RL）では、価値関数 V(s) は「状態 s から開始したときに将来得られる
# 割引報酬和の期待値」を表し、方策評価（Policy Evaluation）や価値反復（Value Iteration）、
# TD学習などの中心的な対象になります。
#
# 本コードではまだ学習（ベルマン更新など）は行わず、
# 「価値関数の器（辞書）を用意して、可視化できる形で持つ」ことを確認する段階です。

# ------------------------------------------------------------
# スクリプトとして直接実行される場合の import パス調整
# ------------------------------------------------------------
# Python では、実行する場所（カレントディレクトリ）やパッケージ構成によって
# import が通らないことがあります。
# ここでは、ファイル実行時（__file__ が存在する時）に限って、
# 「このファイルの1つ上のディレクトリ」を sys.path に追加し、
# ../common/gridworld.py のような相対構造のモジュールを import できるようにしています。
#
# ノートブックや対話環境では __file__ が無いことが多いので、
# if '__file__' in globals(): で分岐して安全にしています。
if "__file__" in globals():
    import os, sys

    # このファイルのディレクトリの親（..）を import 探索パスに追加
    sys.path.append(os.path.join(os.path.dirname(__file__), ".."))

import numpy as np
from common.gridworld import GridWorld

# ------------------------------------------------------------
# GridWorld 環境の生成
# ------------------------------------------------------------
# GridWorld は典型的な「格子状 MDP」の教材環境であり、
# 状態（state）はグリッド上の座標（例：(x, y)）などで表されることが多い。
#
# 以降の RL アルゴリズム（価値反復、方策反復、TD 等）では、
# env.states() で全状態を列挙し、それぞれに V(s) や π(s) を持たせて更新していく。
env = GridWorld()

# ------------------------------------------------------------
# 価値関数 V(s) の初期化
# ------------------------------------------------------------
# V は「状態 -> 価値（スカラー）」を保持する辞書として用意する。
# GridWorld は状態数が有限・小規模なので、配列でも持てるが、
# 状態がタプルなどの場合は辞書（連想配列）のほうが実装が簡単なことが多い。
V = {}

# env.states() は「環境が持つ全状態集合 S」を列挙するイテレータ（またはリスト）を返す想定。
# 各状態 s について V[s] を初期化する。
#
# np.random.randn() は標準正規分布 N(0,1) から乱数を生成する。
# つまり、ここでは価値関数をランダムな値で初期化している。
#
# 理論的観点：
# - 価値反復や方策評価などの反復法では、初期値は任意（ゼロでもランダムでも）でよいことが多い。
# - ただし初期値により「収束までの回数」や「途中経過の見え方」は変わる。
# - ランダム初期化は、可視化してみたときに「値が状態ごとにバラバラ」であることが直感的に分かる。
for state in env.states():
    V[state] = np.random.randn()

# ------------------------------------------------------------
# 価値関数の可視化
# ------------------------------------------------------------
# env.render_v(V) は、グリッド上に V(s) を表示するためのユーティリティ関数。
# たとえば各セルに数値を書いたり、色でヒートマップ表示したりすることで、
# 「どの状態の価値が高い/低いか」を人間が理解しやすくする。
#
# 以降、ベルマン更新などで V を更新すると、ゴールに近いほど価値が高い／罠に近いほど低い、
# といった構造が現れ、それを視覚的に確認できるようになる。
env.render_v(V)
